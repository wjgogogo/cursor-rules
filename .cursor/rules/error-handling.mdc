---
description: 
globs: 
alwaysApply: true
---
# é”™è¯¯å¤„ç†è§„èŒƒ

## æ ¸å¿ƒåŸåˆ™ [P0]

ã€å¿…é¡»ã€‘å»ºç«‹ç»Ÿä¸€çš„é”™è¯¯å¤„ç†ç­–ç•¥ï¼š
- åˆ†å±‚é”™è¯¯å¤„ç†ï¼šç»„ä»¶çº§ â†’ é¡µé¢çº§ â†’ åº”ç”¨çº§
- ç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
- å®Œæ•´çš„é”™è¯¯æ—¥å¿—è®°å½•
- ä¼˜é›…çš„é”™è¯¯æ¢å¤æœºåˆ¶

## é”™è¯¯ç±»å‹å®šä¹‰ [P0]

ã€å¿…é¡»ã€‘ä½¿ç”¨ç»Ÿä¸€çš„é”™è¯¯ç±»å‹ï¼š

```tsx
interface AppError {
  type: 'validation' | 'network' | 'business' | 'system';
  code: string;
  message: string;
  timestamp: string;
}

// å¿«é€Ÿåˆ›å»ºé”™è¯¯
const createError = (type: AppError['type'], code: string, message: string): AppError => ({
  type,
  code,
  message,
  timestamp: new Date().toISOString(),
});
```

## API é”™è¯¯å¤„ç† [P0]

ã€å¿…é¡»ã€‘ç»Ÿä¸€å¤„ç† API é”™è¯¯ï¼š

```tsx
async function apiRequest<T>(url: string, options?: RequestInit): Promise<T> {
  try {
    const response = await fetch(url, options);
    
    if (!response.ok) {
      throw createError('network', `HTTP_${response.status}`, `è¯·æ±‚å¤±è´¥: ${response.statusText}`);
    }
    
    return response.json();
  } catch (error) {
    if (error instanceof TypeError) {
      throw createError('network', 'NETWORK_ERROR', 'ç½‘ç»œè¿æ¥å¤±è´¥');
    }
    throw error;
  }
}
```

## å…¨å±€é”™è¯¯å¤„ç† [P1]

ã€å¿…é¡»ã€‘è®¾ç½®å…¨å±€é”™è¯¯å¤„ç†å™¨ï¼š

```tsx
// åœ¨åº”ç”¨æ ¹ç»„ä»¶ä¸­è®¾ç½®
function setupGlobalErrorHandlers() {
  // æœªæ•è·çš„ Promise é”™è¯¯
  window.addEventListener('unhandledrejection', (event) => {
    console.error('æœªå¤„ç†çš„ Promise é”™è¯¯:', event.reason);
    // ä¸ŠæŠ¥é”™è¯¯åˆ°ç›‘æ§ç³»ç»Ÿ
  });

  // æœªæ•è·çš„ JavaScript é”™è¯¯
  window.addEventListener('error', (event) => {
    console.error('JavaScript é”™è¯¯:', event.error);
    // ä¸ŠæŠ¥é”™è¯¯åˆ°ç›‘æ§ç³»ç»Ÿ
  });
}
```

## é”™è¯¯æ—¥å¿—è®°å½• [P1]

ã€å¿…é¡»ã€‘è®°å½•é”™è¯¯è¯¦æƒ…ï¼š

```tsx
function logError(error: AppError, context?: Record<string, any>) {
  const logData = {
    ...error,
    context,
    url: window.location.href,
    userAgent: navigator.userAgent,
  };

  // å¼€å‘ç¯å¢ƒï¼šæ§åˆ¶å°è¾“å‡º
  if (process.env.NODE_ENV === 'development') {
    console.error('Error:', logData);
  }

  // ç”Ÿäº§ç¯å¢ƒï¼šå‘é€åˆ°ç›‘æ§æœåŠ¡
  if (process.env.NODE_ENV === 'production') {
    // å‘é€åˆ° Sentryã€LogRocket ç­‰æœåŠ¡
  }
}
```

## é‡è¯•æœºåˆ¶ [P2]

ã€æ¨èã€‘ä¸ºç½‘ç»œè¯·æ±‚æ·»åŠ é‡è¯•ï¼š

```tsx
async function withRetry<T>(
  operation: () => Promise<T>,
  maxRetries: number = 3
): Promise<T> {
  for (let i = 0; i <= maxRetries; i++) {
    try {
      return await operation();
    } catch (error) {
      if (i === maxRetries) throw error;
      await new Promise(resolve => setTimeout(resolve, 1000 * i));
    }
  }
  throw new Error('é‡è¯•æ¬¡æ•°å·²ç”¨å®Œ');
}
```

## ğŸ” æ£€æŸ¥æ¸…å•

### æ ¸å¿ƒè¦æ±‚ [P0]
- [ ] **é”™è¯¯æ•è·**ï¼šå…³é”®åŠŸèƒ½éƒ½æœ‰é”™è¯¯å¤„ç†
- [ ] **ç”¨æˆ·æç¤º**ï¼šé”™è¯¯ä¿¡æ¯å¯¹ç”¨æˆ·å‹å¥½
- [ ] **é”™è¯¯è¾¹ç•Œ**ï¼šç»„ä»¶é”™è¯¯ä¸ä¼šå´©æºƒæ•´ä¸ªåº”ç”¨

### è´¨é‡æå‡ [P1]
- [ ] **æ—¥å¿—è®°å½•**ï¼šé”™è¯¯ä¿¡æ¯å®Œæ•´è®°å½•
- [ ] **å…¨å±€å¤„ç†**ï¼šè®¾ç½®å…¨å±€é”™è¯¯å¤„ç†å™¨

### å¯é€‰ä¼˜åŒ– [P2]
- [ ] **é‡è¯•æœºåˆ¶**ï¼šç½‘ç»œé”™è¯¯æä¾›é‡è¯•é€‰é¡¹
- [ ] **ä¼˜é›…é™çº§**ï¼šé”™è¯¯æ—¶åº”ç”¨ä»å¯åŸºæœ¬ä½¿ç”¨ 
